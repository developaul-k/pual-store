<div class="sign-container login">
  <form class="form">
    <div class="round-box">
      <div class="h1">로그인</div>
      <div class="column">
        <input type="text" name="email" class="input" placeholder="이메일을 입력해주세요.">
      </div>
      <div class="column">
        <input type="password" name="password" class="input" placeholder="비밀번호를 입력해주세요.">
      </div>
      <div class="column">
        <button type="submit" class="button">로그인</button>
      </div>
      <div class="column">
        계정이 없으신가요?
        <a href="/signup">회원가입</a>
      </div>
      <div class="column">
        <span class="error-message"></span>
      </div>
    </div>
  </form>
</div>

<script>
  const errMsg = msg => go(
    $.qs('.error-message'),
    $.text(msg),
    $.show);

  go(
    $.qs('.form'),
    $.on('submit', (e) => {
      e.preventDefault();

      const { currentTarget: {
        email: { value: emailValue },
        password: { value: passwordValue }
      } } = e;

      if (emailValue == '' || passwordValue == '') return errMsg('이메일 또는 비밀번호를 입력해주세요!');

      go(
        fetch('/signin', {
          method: 'POST',
          headers: {
            'Content-type': 'application/json'
          },
          body: JSON.stringify({
            email: emailValue,
            password: passwordValue
          }),
        }),
        res => res.json(),
        ({ redirectTo }) => location.replace(`http://localhost:3000${redirectTo}`));
    })
  );

  go(
    $.qsa('.input'),
    $.on('focus', () => go(
      $.qsa('.error-message'),
      each(el => el.style.display == 'block' && $.hide(el))
    ))
  );
</script>